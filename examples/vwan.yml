lab:
  name: vwan

kinds:
  - gobgp:
      image: localhost/gobgp:latest
  - frr:
      image: localhost/frr:latest
  - bird:
      image: localhost/bird:latest

routers:
  prisma-mu-us-east1:
    asn: 65534
    kind: frr
    graph_pos: [-150, 200]
  prisma-mu-us-east2:
    asn: 65534
    kind: frr
    graph_pos: [-100, 200]
  prisma-mu-eu-west:
    asn: 65534
    kind: frr
    graph_pos: [100, 200]
  prisma-mu-eu-north:
    asn: 65534
    kind: frr
    graph_pos: [150, 200]
  prisma-sc-us-east:
    asn: 65534
    kind: frr
    graph_pos: [-100, 150]
  prisma-sc-eu-west:
    asn: 65534
    kind: frr
    graph_pos: [100, 150]
  prisma-sc-eu-north:
    asn: 65534
    kind: frr
    graph_pos: [150, 150]
  vwan-us-west:
    asn: 65515
    kind: frr
    graph_pos: [-150, 50]
  vwan-us-east:
    asn: 65515
    kind: frr
    graph_pos: [-100, 0]
  vwan-eu-west:
    asn: 65515
    kind: frr
    graph_pos: [100, 0]
  vwan-eu-north:
    asn: 65515
    kind: frr
    graph_pos: [150, 50]
  dc-us-east:
    asn: 65501
    kind: bird
    graph_pos: [-125, -150]
  dc-eu-west:
    asn: 65502
    kind: bird
    graph_pos: [125, -150]

links:
  - cidr: 192.168.250.0/24
    devices:
      prisma-sc-eu-north:
        interface: eth9
      prisma-sc-eu-west:
        interface: eth9
      prisma-sc-us-east:
        interface: eth9
  - cidr: 192.168.251.0/29
    devices:
      prisma-mu-eu-west:
      prisma-sc-eu-west:
  - cidr: 192.168.251.8/29
    devices:
      prisma-mu-eu-north:
      prisma-sc-eu-north:
  - cidr: 192.168.251.16/29
    devices:
      prisma-mu-us-east1:
      prisma-mu-us-east2:
      prisma-sc-us-east:
  - cidr: 192.168.240.0/24
    devices:
      vwan-eu-north:
        interface: eth9
      vwan-eu-west:
        interface: eth9
      vwan-us-east:
        interface: eth9
      vwan-us-west:
        interface: eth9
  - cidr: 192.168.230.0/30
    bgp_connect: true
    devices:
      dc-eu-west:
        interface: eth9
      dc-us-east:
        interface: eth9
  - cidr: 192.168.2.0/30
    bgp_connect: true
    devices:
      prisma-sc-us-east:
      vwan-us-east:
  - cidr: 192.168.2.4/30
    bgp_connect: true
    devices:
      prisma-sc-eu-west:
      vwan-eu-west:
  - cidr: 192.168.2.8/30
    bgp_connect: true
    devices:
      prisma-sc-eu-north:
      vwan-eu-north:
  - cidr: 192.168.3.0/29
    devices:
      dc-us-east:
      vwan-us-east:
      vwan-us-west:
  - cidr: 192.168.3.8/29
    devices:
      dc-eu-west:
      vwan-eu-north:
      vwan-eu-west:
  # VPN backup link (cross-region)
  - cidr: 192.168.4.0/30
    type: vpn
    bgp_connect: true
    devices:
      dc-us-east:
      vwan-eu-west:
  - cidr: 192.168.4.4/30
    type: vpn
    bgp_connect: true
    devices:
      dc-eu-west:
      vwan-us-east:

bgp:
  # Prisma SC mesh (iBGP)
  - mesh:
      - prisma-sc-eu-west
      - prisma-sc-eu-north
      - prisma-sc-us-east
    graph_pos: [0, 125]
  # Prisma SC -> MU route reflector relationships
  - rr_server: prisma-sc-eu-west
    rr_clients:
      - prisma-mu-eu-west
  - rr_server: prisma-sc-eu-north
    rr_clients:
      - prisma-mu-eu-north
  - rr_server: prisma-sc-us-east
    rr_clients:
      - prisma-mu-us-east1
      - prisma-mu-us-east2
  # VWAN hub mesh with AS prepend (simulates Azure hub-hub)
  - mesh:
      - vwan-eu-west
      - vwan-eu-north
      - vwan-us-west
      - vwan-us-east
    as_prepend:
      - 65520
      - 65520
    graph_pos: [0, 25]
  # VWAN + DC regional meshes
  - mesh:
      - vwan-us-east
      - vwan-us-west
      - dc-us-east
    graph_pos: [-125, -75]
  - mesh:
      - vwan-eu-west
      - vwan-eu-north
      - dc-eu-west
    graph_pos: [125, -75]

networks:
  prisma-mu-us-east1:
    - prefix: 172.16.131.0/24
      community: "65534:33"
  prisma-mu-us-east2:
    - prefix: 172.16.132.0/24
      community: "65534:33"
  prisma-mu-eu-west:
    - prefix: 172.16.111.0/24
      community: "65534:11"
    - prefix: 172.16.112.0/24
      community: "65534:11"
  prisma-mu-eu-north:
    - prefix: 172.16.121.0/24
      community: "65534:22"
    - prefix: 172.16.122.0/24
      community: "65534:22"
  vwan-dc-west:
    - prefix: 172.17.31.0/24
      community: "12076:50006"
    - prefix: 172.17.32.0/24
      community: "12076:50006"
  vwan-dc-east:
    - prefix: 172.17.41.0/24
      community: "12076:50004"
    - prefix: 172.17.42.0/24
      community: "12076:50004"
  vwan-eu-west:
    - prefix: 172.17.11.0/24
      community: "12076:50002"
    - prefix: 172.17.12.0/24
      community: "12076:50002"
  vwan-eu-north:
    - prefix: 172.17.21.0/24
      community: "12076:50003"
    - prefix: 172.17.22.0/24
      community: "12076:50003"
  dc-eu-west:
    - prefix: 172.18.211.0/24
      community: "65501:10"
    - prefix: 172.18.212.0/24
      community: "65501:10"
  dc-us-east:
    - prefix: 172.18.231.0/24
      community: "65502:20"
    - prefix: 172.18.232.0/24
      community: "65502:20"
